<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFC åºè™Ÿç®¡ç†å“¡</title>
    <link rel="manifest" href="manifest.json">
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; text-align: center; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, textarea { width: 90%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; }
        button { width: 90%; padding: 15px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin: 5px; }
        .btn-blue { background: #007bff; color: white; }
        .btn-green { background: #28a745; color: white; }
    </style>
</head>
<body>
    <h2>ğŸ“¦ NFC åºè™Ÿç®¡ç†</h2>

    <div class="card">
        <h3>å¯«å…¥è‡ªè¨‚åºè™Ÿ</h3>
        <input type="text" id="targetSN" placeholder="ä¾‹å¦‚ï¼šBOX-01">
        <button class="btn-blue" onclick="writeNFC()">æ„Ÿæ‡‰å¯«å…¥è²¼ç´™</button>
    </div>

    <div class="card">
        <h3>æƒæç‰©å“</h3>
        <button class="btn-green" onclick="readNFC()">é–‹å§‹æƒæ</button>
        <div id="editArea" style="display:none; border-top: 1px solid #eee; margin-top: 20px;">
            <p>ç›®å‰åºè™Ÿï¼š<b id="activeSN"></b></p>
            <textarea id="itemsList" rows="5" placeholder="è¼¸å…¥æ­¤åºè™Ÿä»£è¡¨çš„å…§å®¹ç‰©..."></textarea>
            <button class="btn-blue" onclick="saveData()">å„²å­˜åˆ°æ‰‹æ©Ÿ</button>
        </div>
    </div>

    <p id="msg" style="color: #666;"></p>

    <script>
        // è¨»å†Š Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }

        let currentSN = "";

        async function writeNFC() {
            const sn = document.getElementById('targetSN').value;
            if(!sn) return alert("è«‹è¼¸å…¥åºè™Ÿ");
            try {
                const ndef = new NDEFReader();
                await ndef.write(sn);
                alert("åºè™Ÿ " + sn + " å¯«å…¥æˆåŠŸï¼");
            } catch (e) { alert("å¤±æ•—ï¼š" + e); }
        }

        async function readNFC() {
            try {
                const ndef = new NDEFReader();
                await ndef.scan();
                document.getElementById('msg').innerText = "è«‹æ„Ÿæ‡‰è²¼ç´™...";
                ndef.onreading = event => {
                    const decoder = new TextDecoder();
                    currentSN = decoder.decode(event.message.records[0].data);
                    document.getElementById('activeSN').innerText = currentSN;
                    document.getElementById('itemsList').value = localStorage.getItem("NFC_DATA_" + currentSN) || "";
                    document.getElementById('editArea').style.display = "block";
                    document.getElementById('msg').innerText = "è®€å–æˆåŠŸï¼";
                    navigator.vibrate(200);
                };
            } catch (e) { alert("ç„¡æ³•é–‹å•Ÿæƒæï¼š" + e); }
        }

        function saveData() {
            const content = document.getElementById('itemsList').value;
            localStorage.setItem("NFC_DATA_" + currentSN, content);
            alert("å·²å„²å­˜åœ¨æœ¬åœ°ï¼");
        }
    </script>
</body>
</html>
